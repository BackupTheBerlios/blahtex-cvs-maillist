<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Blahtex-cvs] blahtex/includes DefaultSettings.php,1.19,1.20 OutputPage.php,1.13,1.14 Parser.php,1.5,1.6 SkinTemplate.php,1.14,1.15 PersistentObject.php,1.1.1.1,NONE
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/blahtex-cvs/2006-April/index.html" >
   <LINK REL="made" HREF="mailto:blahtex-cvs%40lists.berlios.de?Subject=Re%3A%20%5BBlahtex-cvs%5D%20blahtex/includes%20DefaultSettings.php%2C1.19%2C1.20%20OutputPage.php%2C1.13%2C1.14%20Parser.php%2C1.5%2C1.6%20SkinTemplate.php%2C1.14%2C1.15%20PersistentObject.php%2C1.1.1.1%2CNONE&In-Reply-To=%3C200604141222.k3ECMSt13214%40bat.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000190.html">
   <LINK REL="Next"  HREF="000192.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Blahtex-cvs] blahtex/includes DefaultSettings.php,1.19,1.20 OutputPage.php,1.13,1.14 Parser.php,1.5,1.6 SkinTemplate.php,1.14,1.15 PersistentObject.php,1.1.1.1,NONE</H1>
    <B>jitseniesen</B> 
    <A HREF="mailto:blahtex-cvs%40lists.berlios.de?Subject=Re%3A%20%5BBlahtex-cvs%5D%20blahtex/includes%20DefaultSettings.php%2C1.19%2C1.20%20OutputPage.php%2C1.13%2C1.14%20Parser.php%2C1.5%2C1.6%20SkinTemplate.php%2C1.14%2C1.15%20PersistentObject.php%2C1.1.1.1%2CNONE&In-Reply-To=%3C200604141222.k3ECMSt13214%40bat.berlios.de%3E"
       TITLE="[Blahtex-cvs] blahtex/includes DefaultSettings.php,1.19,1.20 OutputPage.php,1.13,1.14 Parser.php,1.5,1.6 SkinTemplate.php,1.14,1.15 PersistentObject.php,1.1.1.1,NONE">nobody at sheep.berlios.de
       </A><BR>
    <I>Fri Apr 14 14:22:28 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000190.html">[Blahtex-cvs] blahtex/math html.cmi,1.1.1.1,NONE html.cmx,1.1.1.1,NONE lexer.cmi,1.1.1.1,NONE lexer.cmx,1.1.1.1,NONE mathml.cmi,1.1.1.1,NONE mathml.cmx,1.1.1.1,NONE parser.cmi,1.1.1.1,NONE parser.cmx,1.1.1.1,NONE render.cmi,1.1.1.1,NONE render.cmx,1.1.1.1,NONE render_info.cmi,1.1.1.1,NONE tex.cmi,1.1.1.1,NONE texutil.cmi,1.1.1.1,NONE texutil.cmx,1.1.1.1,NONE texvc,1.1.1.1,NONE texvc.cmi,1.1.1.1,NONE texvc.cmx,1.1.1.1,NONE texvc_test,1.1.1.1,NONE texvc_test.cmi,1.1.1.1,NONE texvc_test.cmx,1.1.1.1,NONE texvc_tex.cmi,1.1.1.1,NONE texvc_tex.cmx,1.1.1.1,NONE util.cmi,1.1.1.1,NONE util.cmx,1.1.1.1,NONE
</A></li>
        <LI>Next message: <A HREF="000192.html">[Blahtex-cvs] blahtex/languages Language.php,1.13,1.14 Messages.php,1.5,1.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#191">[ date ]</a>
              <a href="thread.html#191">[ thread ]</a>
              <a href="subject.html#191">[ subject ]</a>
              <a href="author.html#191">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Update of /cvsroot/blahtex/blahtex/includes
In directory sheep:/tmp/cvs-serv10854/includes

Modified Files:
	DefaultSettings.php OutputPage.php Parser.php SkinTemplate.php 
Removed Files:
	PersistentObject.php 
Log Message:
Merge changes from MediaWiki SVN


Index: DefaultSettings.php
===================================================================
RCS file: /cvsroot/blahtex/blahtex/includes/DefaultSettings.php,v
retrieving revision 1.19
retrieving revision 1.20
diff -C2 -d -r1.19 -r1.20
*** DefaultSettings.php	10 Apr 2006 12:27:32 -0000	1.19
--- DefaultSettings.php	14 Apr 2006 12:22:51 -0000	1.20
***************
*** 752,755 ****
--- 752,766 ----
  
  /**
+  * If on, the sidebar navigation links are cached for users with the
+  * current language set. This can save a touch of load on a busy site
+  * by shaving off extra message lookups.
+  *
+  * However it is also fragile: changing the site configuration, or
+  * having a variable $wgArticlePath, can produce broken links that
+  * don't update as expected.
+  */
+ $wgEnableSidebarCache = false;
+ 
+ /**
   * Under which condition should a page in the main namespace be counted
   * as a valid article? If $wgUseCommaCount is set to true, it will be
***************
*** 1925,1928 ****
--- 1936,1943 ----
  $wgAjaxExportList = array( 'wfSajaxSearch' );
  
+ /**
+  * Allow DISPLAYTITLE to change title display
+  */
+ $wgAllowDisplayTitle = false ;
  
  ?&gt;

Index: OutputPage.php
===================================================================
RCS file: /cvsroot/blahtex/blahtex/includes/OutputPage.php,v
retrieving revision 1.13
retrieving revision 1.14
diff -C2 -d -r1.13 -r1.14
*** OutputPage.php	10 Apr 2006 12:27:32 -0000	1.13
--- OutputPage.php	14 Apr 2006 12:22:51 -0000	1.14
***************
*** 19,23 ****
  	var $mSubtitle, $mRedirect, $mStatusCode;
  	var $mLastModified, $mETag, $mCategoryLinks;
! 	var $mScripts, $mLinkColours;
  
  	var $mSuppressQuickbar;
--- 19,23 ----
  	var $mSubtitle, $mRedirect, $mStatusCode;
  	var $mLastModified, $mETag, $mCategoryLinks;
! 	var $mScripts, $mLinkColours, $mPageLinkTitle;
  
  	var $mSuppressQuickbar;
***************
*** 41,49 ****
  		$this-&gt;mRedirect = $this-&gt;mLastModified =
  		$this-&gt;mSubtitle = $this-&gt;mDebugtext = $this-&gt;mRobotpolicy =
! 		$this-&gt;mOnloadHandler = '';
  		$this-&gt;mIsArticleRelated = $this-&gt;mIsarticle = $this-&gt;mPrintable = true;
  		$this-&gt;mSuppressQuickbar = $this-&gt;mPrintable = false;
  		$this-&gt;mLanguageLinks = array();
! 		$this-&gt;mCategoryLinks = array() ;
  		$this-&gt;mDoNothing = false;
  		$this-&gt;mContainsOldMagic = $this-&gt;mContainsNewMagic = 0;
--- 41,49 ----
  		$this-&gt;mRedirect = $this-&gt;mLastModified =
  		$this-&gt;mSubtitle = $this-&gt;mDebugtext = $this-&gt;mRobotpolicy =
! 		$this-&gt;mOnloadHandler = $this-&gt;mPageLinkTitle = '';
  		$this-&gt;mIsArticleRelated = $this-&gt;mIsarticle = $this-&gt;mPrintable = true;
  		$this-&gt;mSuppressQuickbar = $this-&gt;mPrintable = false;
  		$this-&gt;mLanguageLinks = array();
! 		$this-&gt;mCategoryLinks = array();
  		$this-&gt;mDoNothing = false;
  		$this-&gt;mContainsOldMagic = $this-&gt;mContainsNewMagic = 0;
***************
*** 55,59 ****
  	}
  
! 	function addHeader( $name, $val ) { array_push( $this-&gt;mHeaders, $name.': '.$val ) ; }
  	function redirect( $url, $responsecode = '302' ) { $this-&gt;mRedirect = $url; $this-&gt;mRedirectCode = $responsecode; }
  	function setStatusCode( $statusCode ) { $this-&gt;mStatusCode = $statusCode; }
--- 55,59 ----
  	}
  
! 	function addHeader( $name, $val ) { array_push( $this-&gt;mHeaders, $name.': '.$val ); }
  	function redirect( $url, $responsecode = '302' ) { $this-&gt;mRedirect = $url; $this-&gt;mRedirectCode = $responsecode; }
  	function setStatusCode( $statusCode ) { $this-&gt;mStatusCode = $statusCode; }
***************
*** 834,840 ****
  		if( is_string( $source ) ) {
  			if( strcmp( $source, '' ) == 0 ) {
! 				global $wgTitle ;
  				if ( $wgTitle-&gt;getNamespace() == NS_MEDIAWIKI ) {
! 					$source = wfMsgWeirdKey ( $wgTitle-&gt;getText() ) ;
  				} else {
  					$source = wfMsg( $wgUser-&gt;isLoggedIn() ? 'noarticletext' : 'noarticletextanon' );
--- 834,840 ----
  		if( is_string( $source ) ) {
  			if( strcmp( $source, '' ) == 0 ) {
! 				global $wgTitle;
  				if ( $wgTitle-&gt;getNamespace() == NS_MEDIAWIKI ) {
! 					$source = wfMsgWeirdKey ( $wgTitle-&gt;getText() );
  				} else {
  					$source = wfMsg( $wgUser-&gt;isLoggedIn() ? 'noarticletext' : 'noarticletextanon' );

Index: Parser.php
===================================================================
RCS file: /cvsroot/blahtex/blahtex/includes/Parser.php,v
retrieving revision 1.5
retrieving revision 1.6
diff -C2 -d -r1.5 -r1.6
*** Parser.php	10 Apr 2006 12:27:32 -0000	1.5
--- Parser.php	14 Apr 2006 12:22:51 -0000	1.6
***************
*** 2108,2111 ****
--- 2108,2131 ----
  			case MAG_SUBPAGENAMEE:
  				return $this-&gt;mTitle-&gt;getSubpageUrlForm();
+ 			case MAG_TALKPAGENAME:
+ 				if( $this-&gt;mTitle-&gt;canTalk() ) {
+ 					$talkPage = $this-&gt;mTitle-&gt;getTalkPage();
+ 					return $talkPage-&gt;getPrefixedText();
+ 				} else {
+ 					return '';
+ 				}
+ 			case MAG_TALKPAGENAMEE:
+ 				if( $this-&gt;mTitle-&gt;canTalk() ) {
+ 					$talkPage = $this-&gt;mTitle-&gt;getTalkPage();
+ 					return $talkPage-&gt;getPrefixedUrl();
+ 				} else {
+ 					return '';
+ 				}
+ 			case MAG_SUBJECTPAGENAME:
+ 				$subjPage = $this-&gt;mTitle-&gt;getSubjectPage();
+ 				return $subjPage-&gt;getPrefixedText();
+ 			case MAG_SUBJECTPAGENAMEE:
+ 				$subjPage = $this-&gt;mTitle-&gt;getSubjectPage();
+ 				return $subjPage-&gt;getPrefixedUrl();
  			case MAG_REVISIONID:
  				return $this-&gt;mRevisionId;
***************
*** 2114,2117 ****
--- 2134,2145 ----
  			case MAG_NAMESPACEE:
  				return wfUrlencode( $wgContLang-&gt;getNsText( $this-&gt;mTitle-&gt;getNamespace() ) );
+ 			case MAG_TALKSPACE:
+ 				return $this-&gt;mTitle-&gt;canTalk() ? $this-&gt;mTitle-&gt;getTalkNsText() : '';
+ 			case MAG_TALKSPACEE:
+ 				return $this-&gt;mTitle-&gt;canTalk() ? wfUrlencode( $this-&gt;mTitle-&gt;getTalkNsText() ) : '';
+ 			case MAG_SUBJECTSPACE:
+ 				return $this-&gt;mTitle-&gt;getSubjectNsText();
+ 			case MAG_SUBJECTSPACEE:
+ 				return( wfUrlencode( $this-&gt;mTitle-&gt;getSubjectNsText() ) );
  			case MAG_CURRENTDAYNAME:
  				return $varCache[$index] = $wgContLang-&gt;getWeekdayName( date( 'w', $ts ) + 1 );
***************
*** 2452,2456 ****
  	 */
  	function braceSubstitution( $piece ) {
! 		global $wgContLang;
  		$fname = 'Parser::braceSubstitution';
  		wfProfileIn( $fname );
--- 2480,2484 ----
  	 */
  	function braceSubstitution( $piece ) {
! 		global $wgContLang, $wgAllowDisplayTitle, $action;
  		$fname = 'Parser::braceSubstitution';
  		wfProfileIn( $fname );
***************
*** 2622,2631 ****
  			}
  		}
  
  		# Extensions
! 		if ( !$found ) {
  			$colonPos = strpos( $part1, ':' );
  			if ( $colonPos !== false ) {
! 				$function = strtolower( substr( $part1, 0, $colonPos ) );
  				if ( isset( $this-&gt;mFunctionHooks[$function] ) ) {
  					$funcArgs = array_merge( array( &amp;$this, substr( $part1, $colonPos + 1 ) ), $args );
--- 2650,2686 ----
  			}
  		}
+ 		
+ 		# DISPLAYTITLE
+ 		if ( !$found &amp;&amp; $argc == 1 &amp;&amp; $wgAllowDisplayTitle &amp;&amp; $action == &quot;view&quot; ) {
+ 			$mwDT =&amp; MagicWord::get( MAG_DISPLAYTITLE );
+ 			if ( $mwDT-&gt;matchStartAndRemove( $part1 ) ) {
+ 				global $wgOut;
+ 				
+ 				# Only the first one counts...
+ 				if ( $wgOut-&gt;mPageLinkTitle == &quot;&quot; ) {
+ 					$param = $args[0];			
+ 					$parserOptions = new ParserOptions;
+ 					$local_parser = new Parser ();
+ 					$t2 = $local_parser-&gt;parse ( $param, $this-&gt;mTitle, $parserOptions, false );
+ 					$wgOut-&gt;mPageLinkTitle = $wgOut-&gt;getPageTitle();
+ 					$wgOut-&gt;mPagetitle = $t2-&gt;GetText();
+ 	
+ 					# Add subtitle
+ 					$t = $this-&gt;mTitle-&gt;getPrefixedText();
+ 					$st = trim ( $wgOut-&gt;getSubtitle () );
+ 					if ( $st != &quot;&quot; ) $st .= &quot; &quot;;
+ 					$st .= wfMsg('displaytitle', $t);
+ 					$wgOut-&gt;setSubtitle ( $st );
+ 				}
+ 				$text = &quot;&quot; ;
+ 				$found = true ;
+ 			}
+ 		}		
  
  		# Extensions
! 		if ( !$found &amp;&amp; substr( $part1, 0, 1 ) == '#' ) {
  			$colonPos = strpos( $part1, ':' );
  			if ( $colonPos !== false ) {
! 				$function = strtolower( substr( $part1, 1, $colonPos - 1 ) );
  				if ( isset( $this-&gt;mFunctionHooks[$function] ) ) {
  					$funcArgs = array_merge( array( &amp;$this, substr( $part1, $colonPos + 1 ) ), $args );
***************
*** 4014,4018 ****
  
  	function getText()                   { return $this-&gt;mText; }
! 	function getLanguageLinks()          { return $this-&gt;mLanguageLinks; }
  	function getCategoryLinks()          { return array_keys( $this-&gt;mCategories ); }
  	function &amp;getCategories()            { return $this-&gt;mCategories; }
--- 4069,4073 ----
  
  	function getText()                   { return $this-&gt;mText; }
! 	function &amp;getLanguageLinks()          { return $this-&gt;mLanguageLinks; }
  	function getCategoryLinks()          { return array_keys( $this-&gt;mCategories ); }
  	function &amp;getCategories()            { return $this-&gt;mCategories; }
***************
*** 4054,4067 ****
  		$this-&gt;mTemplates[$ns][$dbk] = $id;
  	}
- 
- 	/**
- 	 * @deprecated
- 	 */
- 	/*
- 	function merge( $other ) {
- 		$this-&gt;mLanguageLinks = array_merge( $this-&gt;mLanguageLinks, $other-&gt;mLanguageLinks );
- 		$this-&gt;mCategories = array_merge( $this-&gt;mCategories, $this-&gt;mLanguageLinks );
- 		$this-&gt;mContainsOldMagic = $this-&gt;mContainsOldMagic || $other-&gt;mContainsOldMagic;
- 	}*/
  
  	/**
--- 4109,4112 ----

Index: SkinTemplate.php
===================================================================
RCS file: /cvsroot/blahtex/blahtex/includes/SkinTemplate.php,v
retrieving revision 1.14
retrieving revision 1.15
diff -C2 -d -r1.14 -r1.15
*** SkinTemplate.php	10 Apr 2006 12:27:32 -0000	1.14
--- SkinTemplate.php	14 Apr 2006 12:22:52 -0000	1.15
***************
*** 188,191 ****
--- 188,192 ----
  		$tpl-&gt;set( 'title', $wgOut-&gt;getPageTitle() );
  		$tpl-&gt;set( 'pagetitle', $wgOut-&gt;getHTMLTitle() );
+ 		$tpl-&gt;set( 'displaytitle', $wgOut-&gt;mPageLinkTitle );
  
  		$tpl-&gt;setRef( &quot;thispage&quot;, $this-&gt;thispage );

--- PersistentObject.php DELETED ---


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000190.html">[Blahtex-cvs] blahtex/math html.cmi,1.1.1.1,NONE html.cmx,1.1.1.1,NONE lexer.cmi,1.1.1.1,NONE lexer.cmx,1.1.1.1,NONE mathml.cmi,1.1.1.1,NONE mathml.cmx,1.1.1.1,NONE parser.cmi,1.1.1.1,NONE parser.cmx,1.1.1.1,NONE render.cmi,1.1.1.1,NONE render.cmx,1.1.1.1,NONE render_info.cmi,1.1.1.1,NONE tex.cmi,1.1.1.1,NONE texutil.cmi,1.1.1.1,NONE texutil.cmx,1.1.1.1,NONE texvc,1.1.1.1,NONE texvc.cmi,1.1.1.1,NONE texvc.cmx,1.1.1.1,NONE texvc_test,1.1.1.1,NONE texvc_test.cmi,1.1.1.1,NONE texvc_test.cmx,1.1.1.1,NONE texvc_tex.cmi,1.1.1.1,NONE texvc_tex.cmx,1.1.1.1,NONE util.cmi,1.1.1.1,NONE util.cmx,1.1.1.1,NONE
</A></li>
	<LI>Next message: <A HREF="000192.html">[Blahtex-cvs] blahtex/languages Language.php,1.13,1.14 Messages.php,1.5,1.6
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#191">[ date ]</a>
              <a href="thread.html#191">[ thread ]</a>
              <a href="subject.html#191">[ subject ]</a>
              <a href="author.html#191">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/blahtex-cvs">More information about the Blahtex-cvs
mailing list</a><br>
</body></html>
